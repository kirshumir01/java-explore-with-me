# java-explore-with-me

*Read this on [English](README.en.md).*

## Описание
___

Свободное время — ценный ресурс.
Ежедневно мы планируем, как его потратить — куда и с кем сходить.
Сложнее всего в таком планировании поиск информации и переговоры.
Необходимо учесть множество деталей: какие намечаются мероприятия, свободны ли в этот момент друзья, как всех пригласить и где собраться?

Приложение - афиша событий - позволяет предложить какое-либо событие от выставки до похода в кино и собрать компанию для участия в нём.

![](https://github.com/kirshumir01/java-explore-with-meblob/main/ewm-title.png)

## Структура модулей приложения
___

Приложение состоит из двух отдельно запускаемых сервисов:
- **основной сервис (ewm-main)** - содержит основную функциональность приложения;
- **сервис статистики (ewm-statistic)** - хранит информацию о количестве просмотров событий и позволяет выполнять различные выборки для анализа работы приложения.

Структура модулей и зависимостей представлена ниже в виде схемы.

![](https://github.com/kirshumir01/java-explore-with-meblob/main/ewm-title.png)

### Спецификация API
- [спецификация основного сервиса](https://github.com/kirshumir01/java-explore-with-meblob/main/ewm-main-service-spec.json);
- [спецификация сервиса статистики](https://github.com/kirshumir01/java-explore-with-meblob/main/ewm-stats-service-spec.json).

<br>

<details>

<summary> Подсказка: как открыть спецификацию с помощью редактора Swagger </summary>

1. Скопируйте ссылку на файл спецификации.
2. Откройте онлайн-версию редактора [Swagger](https://editor-next.swagger.io). На верхней панели выберите меню File -> Import URL.
3. Вставьте скопированную ссылку в текстовое поле появившегося диалогового окна и нажмите OK.

</details>

### Основной сервис (main-service)
___

API основного сервиса разделен на три части:
- **публичная** - доступна без регистрации любому пользователю сети;
- **закрытая** - доступна только авторизованным пользователям;
- **административная** — доступна для администраторов сервиса.

#### Структура основного сервиса и функциональность
___
1. Модели данных:
- **пользователи (users):**
  - **_модель данных_**: имя, email;
  - **_валидация данных_**: email не может быть пустым и должна быть уникальным, логин не может быть пустым и содержать пробелы.
- **события (events):**
  - **_модель данных_**: заголовок, аннотация, описание, дата публикации, дата и время начала, инициатор, необходимость оплаты для участия, лимит запросов на участие, статус пре-модерации, статус публикации, количество просмотров;
  - **_валидация данных_**: аннотация от 20 до 2000 символов, описание от 20 до 7000 символов, заголовок от 3 до 120 символов, аннотация, описание, наименование и необходимость оплаты не могут быть пустыми.
- **подборки событий (compilation)**:
  - **_модель данных_**: список событий, статус закрепления подборки на главной странице, заголовок подборки;
  - **_валидация данных_**: заголовок не может быть пустым и содержит от 1 до 50 символов.
- **категории событий (category)**:
  - **_модель данных_**: заголовок категории;
  - **_валидация данных_**: заголовок не может быть пустым, должен быть уникальным и содержать от 1 до 50 символов.
- **место проведения (location)**:
  - **_модель данных_**: координаты - широта и долгота;
  - **_валидация данных_**: координаты не могут быть пустыми.
- **запрос на обновление события (request)**:
  - **_модель данных_**: дата и время проведения события, событие, пользователь, статус запроса;
  - **_валидация данных_**: не предусмотрена.

Примечание: все модели данных содержат поле для присвоения уникального идентификатора создаваемой сущности.

2. Сервисная часть:
2.1. Публичная часть:
- **пользователи (users):**
  - **_действия_**: добавление, обновление, хранение, получение и удаление;
  - **_функционал_**: добавление вещи (владелец), добавление отзыва (комментария) к вещи (арендатор).
- **события (events):**
  - **_действия_**: получение всех событий или конкретного события по id;
  - **_функционал_**: получение событий из заданного пользователем диапазона дат или всех событий после текущей даты, 
получение только опубликованных событий, получение информации и просмотрах и количестве одобренных заявок на участие, 
сохранение информации и просмотре в сервисе статистики.
- **подборки событий (compilation):**
  - **_действия_**: получение всех подборок или конкретной подборки по id;
  - **_функционал_**: поиск подборок по заданным фильтрам.
- **категории событий (category):**
  - **_действия_**: получение всех категорий или конкретной категории по id;
  - **_функционал_**: поиск категорий по заданным фильтрам.

2.2. Закрытая часть:


2.3. Административная часть:


### Сервис статистики
___
Сервис аккумулирует информацию о количестве обращений пользователей к спискам событий и о количестве запросов к 
подробной информации о событии. На основе этой информации формируется статистика о количестве просмотров событий.


#### Структура сервиса статистики и функциональность
___


### Схема базы данных приложения (ER-диаграмма)
![ER-diagram](https://github.com/kirshumir01/java-explore-with-me/blob/EWM-diagram.png)

## Инструменты и технологии
___

- фреймворк: **Spring Boot 3.2.4**:
  - spring-boot-starter-web;
  - spring-boot-starter-validation;
  - spring-boot-starter-jdbc;
  - spring-boot-starter-test.
- аннотирование классов приложения: **Lombok**
- логирование HTTP-запросов и ответов: **Logbook 3.7.2**
- хранение данных (рабочий режим): **H2 Database**
- хранение данных (режим тестирования): **память приложения**
- сборка и управление зависимостями: **Apache Maven 3.9.9**
- версия Java: **21**

## Схема базы данных приложения (ER-диаграмма)
___

![ER-diagram](https://github.com/kirshumir01/java-filmorate/blob/main/java-filmorate-diagram.png)

## Инструменты для запуска приложения
___

- Java Development Kit (JDK) - версия 21 или более поздняя;
- Apache Maven - версия 3.9.9 или более поздняя.

### Инструкции по установке JDK

Ниже приведены инструкции по установке JDK 21 на различных операционных системах.

<br>

<details>

<summary> Установка на macOS </summary>

Установите Homebrew запуском следующей команды в терминале (командной строке) операционной системы:

```shell
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

Установите JDK 21 с помощью Homebrew:

```shell
brew install openjdk@21
```

Создайте символическую ссылку, чтобы система могла найти JDK:

```shell
sudo ln -sfn /opt/homebrew/opt/openjdk@21/libexec/openjdk.jdk /Library/Java/JavaVirtualMachines/openjdk-21.jdk
```

Добавьте JDK 21 в PATH. Откройте файл .zshrc (или .bash_profile, в зависимости от используемой оболочки) и добавьте следующую строку:

```
echo 'export PATH="/opt/homebrew/opt/openjdk@21/bin:$PATH"' >> ~/.zshrc
```

Перезагрузите терминал или примените изменения с помощью команды:

```shell
source ~/.zshrc
```

Проверьте установленную версию Java:

```shell
java -version
```
</details>

<br>

<details>

<summary> Установка на Linux </summary>

Откройте терминал и выполните команду для обновления списка пакетов:

```shell
sudo apt update
```

Установите JDK 21:

```shell
sudo apt install openjdk-21-jdk
```

Убедитесь, что JDK установлен и настроен корректно:

```shell
java -version
```

</details>

<br>

<details>

<summary> Установка на Windows </summary>

1. Скачайте установочный файл JDK 21 с официального сайта [Oracle](https://www.oracle.com/java/technologies/javase/jdk21-archive-downloads.html) или OpenJDK.

2. Запустите установочный файл и следуйте инструкциям установщика.

3. После установки настройте переменную среды JAVA_HOME:
- откройте ```Системные настройки``` > ```Переменные среды```;
- в разделе ```Системные переменные``` нажмите ```Создать``` и введите:
  - имя переменной: ```JAVA_HOME```
  - значение переменной: путь к установленной JDK (например, ```C:\Program Files\Java\jdk-21```).
- добавьте ```JAVA_HOME\bin``` в переменную Path.

4. Проверьте версию Java в командной строке:

```shell
java -version
```

</details>

### Инструкции по установке Maven

Ниже приведены инструкции по установке Maven на различных операционных системах.

<br>

<details>

<summary> Установка на macOS </summary>

Установите Homebrew, если он еще не установлен:

```shell
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

Установите Maven с помощью Homebrew:

```shell
brew install maven
```

Проверьте версию Maven, чтобы убедиться в правильной установке:

```shell
mvn -version
```

</details>

<br>

<details>

<summary> Установка на Linux </summary>

Откройте терминал и загрузите Apache Maven 3.9.9:

```shell
wget https://downloads.apache.org/maven/maven-3/3.9.9/binaries/apache-maven-3.9.9-bin.tar.gz
```

Распакуйте архив:

```shell
tar xzvf apache-maven-3.9.9-bin.tar.gz
```

Переместите распакованную папку в директорию /opt/:

```shell
sudo mv apache-maven-3.9.9 /opt/maven
```

Добавьте Maven в PATH. Откройте файл .bashrc или .zshrc и добавьте следующую строку:

```
export PATH=/opt/maven/bin:$PATH
```
Примените изменения:

```shell
source ~/.bashrc
```

Проверьте версию Maven:

```shell
mvn -version
```

</details>

<br>

<details>

<summary> Установка на Windows </summary>

1. Скачайте установочный архив Maven 3.9.9 с [официального сайта](https://maven.apache.org/download.cgi).

2. Распакуйте архив в удобное место, например ```C:\Program Files\Maven```.

3. Настройте переменные среды:
- откройте ```Системные настройки``` > ```Переменные среды```.
- в разделе ```Системные переменные``` нажмите ```Создать``` и добавьте:
  - имя переменной: ```MAVEN_HOME```
  - значение переменной: путь к папке Maven, например ```C:\Program Files\Maven```.
- найдите переменную Path, выберите ее и нажмите ```Изменить```. Добавьте новый путь: ```%MAVEN_HOME%\bin```.

4. Перезапустите командную строку и проверьте версию Maven:

```shell
mvn -version
```

</details>

## Подготовка к запуску приложения
___

**ВАЖНО!** Запуск приложения осуществляется через системные порты ```8080``` и ```9090```. 
Перед запуском убедитесь, что порты ```8080``` и ```9090``` свободны!

### Как проверить, что системный порт свободен?

Ниже приведены инструкции по проверке порта на различных операционных системах.

<br>

<details>

<summary> Проверка порта на macOS </summary>

Откройте терминал.

Выполните следующую команду, заменив ```PORT``` на номер порта, который нужно проверить:

```
lsof -i :PORT
```

Если порт занят, команда выведет список процессов, использующих порт. Для завершения процесса используйте команду:

```
kill -9 PID
```
где ```PID``` — идентификатор процесса из вывода предыдущей команды.

Если порт свободен, команда не вернет никаких данных.

</details>

<br>

<details>

<summary> Проверка порта на Linux </summary>

Откройте терминал.

Выполните следующую команду, заменив ```PORT``` на номер порта:

```
sudo lsof -i :PORT
```

Если порт занят, команда выведет список процессов, использующих порт. Для завершения процесса используйте команду:

```
sudo kill -9 PID
```
где ```PID``` — идентификатор процесса из вывода предыдущей команды.

Если порт свободен, команда не вернет никаких данных.

</details>

<br>

<details>

<summary> Проверка порта на Windows </summary>

Откройте командную строку (cmd) или PowerShell с правами администратора.

Выполните следующую команду, заменив ```PORT``` на номер порта:

```
netstat -aon | findstr :PORT
```

Если порт занят, команда выведет информацию о процессе, использующем порт. Обратите внимание на PID (идентификатор процесса).

Чтобы завершить процесс, откройте ```Диспетчер задач```, перейдите на вкладку ```Подробности```, найдите процесс с соответствующим PID и завершите его.

Если порт свободен, команда не вернет никаких данных.

</details>

### Где следует выполнять команды для запуска приложения?

- в терминале (командной строке) операционной системы;
- в программной среде разработки [IntelliJ IDEA](https://www.jetbrains.com/ru-ru/idea/download/other.html) непосредственно в данном файле нажатием на символ тройной стрелки ```>>>```, расположенной слева от строки описания соответствующей команды.

## Запуск приложения
___

1. Склонируйте репозиторий с использованием следующей команды:

```shell
git clone https://github.com/kirshumir01/java-explore-with-me
```

2. Перейдите в корневую директорию склонированного проекта и выполните команду:

```shell
cd java-explore-with-me
```

3. Запустите сборку проекта командой:

```shell
./mvnw clean install
```

4. Запустите приложение, выполнив следующую команду:

```shell
./mvnw spring-boot:run
```

Доступ к публичному API основного сервиса будет открыт по ссылке через адресную строку интернет-браузера: `http://localhost:8080`.
Доступ к публичному API сервиса статистики будет открыт по ссылке через адресную строку интернет-браузера: `http://localhost:9090`.

*Read this on [English](README.en.md).*